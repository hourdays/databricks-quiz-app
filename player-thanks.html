<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thank You - Quiz App</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Thank You for Playing!</h1>
            <div class="welcome-message">
                <h2>Great job, <span id="playerName"></span>! üëè</h2>
            </div>
        </div>

        <div class="player-results">
            <div class="result-card">
                <div class="rank-display">
                    <div class="rank-number" id="rankNumber">-</div>
                    <div class="rank-label">Rank</div>
                </div>
                <div class="score-display">
                    <div class="score-number" id="scoreNumber">0</div>
                    <div class="score-label">Points</div>
                </div>
                <div class="total-players">
                    out of <span id="totalPlayers">0</span> players
                </div>
            </div>

            <div class="thank-you-message">
                <h3>Thanks for participating!</h3>
                <p>Your answer has been recorded. The admin will show the final leaderboard shortly.</p>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const playerNameSpan = document.getElementById('playerName');
        const rankNumber = document.getElementById('rankNumber');
        const scoreNumber = document.getElementById('scoreNumber');
        const totalPlayers = document.getElementById('totalPlayers');

        // Extract display name from email
        function extractDisplayName(email) {
            if (!email || email === 'Anonymous') return 'Anonymous';
            const beforeAt = email.split('@')[0];
            const beforeFirstDot = beforeAt.split('.')[0];
            return beforeFirstDot.charAt(0).toUpperCase() + beforeFirstDot.slice(1);
        }

        // Handle player game ended
        socket.on('player-game-ended', (data) => {
            console.log('Player game ended:', data);
            displayResults(data);
        });

        // Handle game reset
        socket.on('game-reset', () => {
            localStorage.clear();
            window.location.href = 'index.html';
        });

        function displayResults(data) {
            const { rank, score, totalPlayers: total } = data;
            
            // Update display
            rankNumber.textContent = rank;
            scoreNumber.textContent = score;
            totalPlayers.textContent = total;
            
            // Add rank-based styling
            if (rank === 1) {
                rankNumber.style.color = '#FFD700'; // Gold
                rankNumber.style.fontSize = '3rem';
            } else if (rank === 2) {
                rankNumber.style.color = '#C0C0C0'; // Silver
                rankNumber.style.fontSize = '2.5rem';
            } else if (rank === 3) {
                rankNumber.style.color = '#CD7F32'; // Bronze
                rankNumber.style.fontSize = '2.2rem';
            }
        }

        // Set up welcome message
        window.addEventListener('load', () => {
            const playerEmail = localStorage.getItem('playerEmail');
            if (playerEmail) {
                const displayName = extractDisplayName(playerEmail);
                playerNameSpan.textContent = displayName;
            }
        });
    </script>
</body>
</html>
